<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Everything I Never Told You!">
<meta property="og:type" content="website">
<meta property="og:title" content="Reed">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Reed">
<meta property="og:description" content="Everything I Never Told You!">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reed">
<meta name="twitter:description" content="Everything I Never Told You!">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Reed</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Reed</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/25/Java编程思想学习笔记（二） ---多态/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/25/Java编程思想学习笔记（二） ---多态/" itemprop="url">
                  Java编程思想学习笔记（二） ---多态
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-25T23:45:16+08:00">
                2016-08-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###一般情况</p>
<p>在Java中使用多态需要注意以下几点：</p>
<ol>
<li>如果某个方法是静态的， 那么该方法就不具有多态性</li>
<li>final修饰的方式是不可被覆盖</li>
<li>private修饰的方法不具备多态性，会被系统自动认为是final修饰的方法，同时对于子类是屏蔽的</li>
<li>虽然子类中可以拥有父类中private修饰的同名方法，编译器不会报错，但是并不会按照我们所期望的运行，所以做好不要采用相同的名字</li>
</ol>
<p>以代码为例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">public class MultiTypeTest &#123;</div><div class="line">	public static void f3() &#123;</div><div class="line">		System.out.println(&quot;multi static&quot;);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	private void f1() &#123;</div><div class="line">		System.out.println(&quot;multi f1()&quot;);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	public void f2() &#123;</div><div class="line">		System.out.println(&quot;multi f2()&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		MultiTypeTest test = new NewType();</div><div class="line">		test.f1();</div><div class="line">		test.f2();</div><div class="line">		test.f3();</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">class NewType extends MultiTypeTest &#123;</div><div class="line">	</div><div class="line">	public void f1() &#123;</div><div class="line">		System.out.println(&quot;new f1()&quot;);</div><div class="line">	&#125;</div><div class="line">	public void f2() &#123;</div><div class="line">		System.out.println(&quot;new f2()&quot;);</div><div class="line">	&#125;</div><div class="line">	public static void f3() &#123;</div><div class="line">		System.out.println(&quot;new static&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">multi f1()</div><div class="line">new f2()</div><div class="line">multi static</div></pre></td></tr></table></figure></p>
<p>由运行结果可知，f1()方法的对比对应的是第3点和第4点，f3()方法的对比对应的是第1点，至于第二点，编译器会报错。</p>
<p><strong>总结</strong></p>
<ol>
<li>子类继承父类，子类可以继承父类的所有非private方法和属性，同时也可以重写父类非final和static修饰的方法</li>
<li>当子类的引用指向父类的对象时，父类的对象除可以调用自己本身的属性和方法外，只能调用子类重写的方法，不可调用子类特有的方法和属性。</li>
</ol>
<p>###构造器内部的多态</p>
<p>构造器初始化的实际过程：</p>
<ol>
<li>在其他任何事物发生之前，将分配给对象的存储空间初始化成二进制的零。</li>
<li>调用基类构造方法。此时如果基类构造方法中调用了一个方法，该方法在子类中被重写过，那么实际调用的是子类重写的方法，见稍后代码。</li>
<li>按照申明顺序调用成员的初始化方法</li>
<li>调用子类的构造方法</li>
</ol>
<p>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">class Base &#123;</div><div class="line">	void print() &#123;</div><div class="line">		System.out.println(&quot;print()&quot;);</div><div class="line">	&#125;</div><div class="line">	public Base() &#123;</div><div class="line">		System.out.println(&quot;base() before&quot;);</div><div class="line">		print();</div><div class="line">		System.out.println(&quot;base() after&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">class ExtendBase extends Base &#123;</div><div class="line">	private int value = 1;</div><div class="line">	void print() &#123;</div><div class="line">		System.out.println(&quot;extend, value = &quot;+ value);</div><div class="line">	&#125;</div><div class="line">	public ExtendBase(int value) &#123;</div><div class="line">		System.out.println(&quot;extend init before, value = &quot;+ this.value);</div><div class="line">		this.value = value;</div><div class="line">		System.out.println(&quot;extend init after, value = &quot;+ this.value);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div><div class="line">public class MultiTypeTest &#123;</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		new ExtendBase(5);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输入结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">base() before</div><div class="line">extend, value = 0</div><div class="line">base() after</div><div class="line">extend init before, value = 1</div><div class="line">extend init after, value = 5</div></pre></td></tr></table></figure></p>
<p>有结果可知，先初始基类构造方法，之后由于基类构造方法里调用了print()方法，故调用的是子类的print()方法，同时此时的value值为0（参见第一点）， 之后便是正常的顺序执行初始化过程。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/19/Android中自定义键盘的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/19/Android中自定义键盘的实现/" itemprop="url">
                  Android中自定义键盘的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-19T15:52:40+08:00">
                2016-08-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>前言</strong></p>
<p>由于项目需求， 需要自定义一个数字键盘用于输入数字， 同时要实现简单的计算器功能，即加减乘除。下面，我以自定义一个计算器键盘来说明实现一个自定义键盘的过程</p>
<p><strong>定义布局</strong></p>
<p>自定义键盘的第一步，就是确定布局。首先在资源文件夹下建一个xml目录，在目录中新建一个键盘布局文件，比如keyboard.xml。先给上我的布局代码，后面具体分析<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;Keyboard xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:keyHeight=&quot;9%p&quot;</div><div class="line">    android:keyWidth=&quot;25%p&quot;&gt;</div><div class="line"></div><div class="line">    &lt;Row&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;-1&quot;</div><div class="line">            android:keyLabel=&quot;C&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;42&quot;</div><div class="line">            android:keyLabel=&quot;×&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;47&quot;</div><div class="line">            android:keyLabel=&quot;÷&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;-2&quot;</div><div class="line">            android:keyIcon=&quot;@mipmap/delete&quot; /&gt;</div><div class="line">    &lt;/Row&gt;</div><div class="line"></div><div class="line">    &lt;Row&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;55&quot;</div><div class="line">            android:keyLabel=&quot;7&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;56&quot;</div><div class="line">            android:keyLabel=&quot;8&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;57&quot;</div><div class="line">            android:keyLabel=&quot;9&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;45&quot;</div><div class="line">            android:keyLabel=&quot;-&quot; /&gt;</div><div class="line">    &lt;/Row&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;Row&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;52&quot;</div><div class="line">            android:keyLabel=&quot;4&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;53&quot;</div><div class="line">            android:keyLabel=&quot;5&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;54&quot;</div><div class="line">            android:keyLabel=&quot;6&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;43&quot;</div><div class="line">            android:keyLabel=&quot;+&quot; /&gt;</div><div class="line">    &lt;/Row&gt;</div><div class="line"></div><div class="line">    &lt;Row&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;49&quot;</div><div class="line">            android:keyLabel=&quot;1&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;50&quot;</div><div class="line">            android:keyLabel=&quot;2&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;51&quot;</div><div class="line">            android:keyLabel=&quot;3&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;-3&quot;</div><div class="line">            android:keyIcon=&quot;@mipmap/cancel&quot; /&gt;</div><div class="line">    &lt;/Row&gt;</div><div class="line"></div><div class="line">    &lt;Row&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;-5&quot;</div><div class="line">            android:keyLabel=&quot; &quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;48&quot;</div><div class="line">            android:keyLabel=&quot;0&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;46&quot;</div><div class="line">            android:keyLabel=&quot;.&quot; /&gt;</div><div class="line">        &lt;Key</div><div class="line">            android:codes=&quot;-4&quot;</div><div class="line">            android:keyIcon=&quot;@mipmap/confirm&quot; /&gt;</div><div class="line">    &lt;/Row&gt;</div><div class="line"></div><div class="line">&lt;/Keyboard&gt;</div></pre></td></tr></table></figure></p>
<p><row>元素代表键盘布局的一行, android:keyHeight和android:keyWidth分别表示键盘上每个键的高度和宽度，%p表示占键盘总宽度的或者总高度的百分之几，每个元素都有这两个属性，由于我的需求中每个键盘的按键大小都是相同的，所以统一设置在<keyboard>元素里。<key>元素表示键盘的按键，其中重点关注以下几个属性</key></keyboard></row></p>
<ul>
<li>android:codes 该属性是键盘的唯一标识，有点类似身份证的效果，一般我们把数字、英文字符、特殊符号的asiic码作为键盘的code, 这样可以方便将asiic码直接作为内容输入，在后面我会提到具体用法。当然有人可能会问，万一我要输入的东西没有asiic码怎么办，刚刚只是说了一般情况，这个codes值也是可以自定义的，只要是键盘里唯一的就好了。</li>
<li>android:keyLabel 该属性表示键盘上显示的文本内容</li>
<li>android:keyIcon 有键盘上显示的不一定是文字，有可能是图片，该属性就是用来显示图片的。</li>
</ul>
<p>其他的属性可以参见google<a href="https://developer.android.com/reference/android/inputmethodservice/Keyboard.html" target="_blank" rel="external">官方文档</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/17/Java编程思想学习笔记（一）---初始化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/17/Java编程思想学习笔记（一）---初始化/" itemprop="url">
                  Java编程思想学习笔记（一）---初始化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-17T22:31:07+08:00">
                2016-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一般来说， Java中对象的初始化顺序是先初始化静态成员变量， 再初始化非静态成员变量， 最后调用构造方法, 需要注意的是静态成员变量只会在该类第一次初始化一个对象的时候进行初始化， 之后. 初始化对象时将不再进行静态成员变量的初始化。</p>
<p>以以下代码为例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">class A &#123;</div><div class="line">	public A(int i) &#123;</div><div class="line">		System.out.println(&quot;A&quot; + i);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">class B &#123;</div><div class="line">	static A a1 = new A(1);</div><div class="line">	public B(int i) &#123;</div><div class="line">		System.out.println(&quot;B&quot; + i);</div><div class="line">	&#125;</div><div class="line">	static B b1 = new B(1);</div><div class="line">&#125;</div><div class="line">class C &#123;</div><div class="line">	static B b2 = new B(2);</div><div class="line">	B b3 = new B(3);</div><div class="line">	public C(int i) &#123;</div><div class="line">		System.out.println(&quot;C&quot; + i);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">public class InitTest &#123;</div><div class="line">	static C c1 = new C(1);</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		C c2 = new C(2);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后在控制台输出的结果是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">A1</div><div class="line">B1</div><div class="line">B2</div><div class="line">B3</div><div class="line">C1</div><div class="line">B3</div><div class="line">C2</div></pre></td></tr></table></figure></p>
<p>由输出结果可以看出：</p>
<ol>
<li>当执行程序时， 首先是先进行c1的初始化， 再进行C2的初始化。</li>
<li>在进行c1初始化时， 首先进行b2的初始化， 再进行b3的初始化， 最后才会执行构造方法。</li>
<li>在进行b2初始化时， 同样的先进行a1的初始化， 再进行b1的初始化， 最后执行构造方法</li>
<li>由于a1, b1, b2是静态成员变量， 所以只会进行一次初始化， 在c2初始化时便不再执行相应的初始化方法</li>
<li>由于b3是非静态成员变量， 所以c1和c2初始化时都会初始化b3</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/14/搭建ghost博客/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/搭建ghost博客/" itemprop="url">
                  搭建ghost博客
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T00:28:24+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###初始化VPS<br>如果没有安装yum源，先安装yum源。之后安装依赖文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum update //更新yum源  </div><div class="line">yum groupinstall &quot;Development Tools&quot; //安装开发工具组包  </div><div class="line">yum install wget</div></pre></td></tr></table></figure></p>
<p>###安装mysql<br><strong>1. 下载MySQL官方的Yum Repository</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm</div></pre></td></tr></table></figure></p>
<p><strong>2. 安装MySQL的Yum Repository</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh mysql-community-release-el7-5.noarch.rpm</div></pre></td></tr></table></figure></p>
<p><strong>3. 安装MySQL数据库的服务器版本</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-community-server</div></pre></td></tr></table></figure></p>
<p><strong>4. 启动数据库</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">systemctl enable mysqld</div><div class="line">systemctl start  mysqld.service</div><div class="line">//查看运行状态</div><div class="line">systemctl status mysqld.service</div><div class="line">service mysqld restart</div></pre></td></tr></table></figure></p>
<p><strong>5. 设置数据库密码</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//5.7以上版本要先获取初始密码</div><div class="line">grep &quot;password&quot; /var/log/mysqld.log</div><div class="line">//利用初始密码登录</div><div class="line">mysql -uroot -p</div><div class="line">//设置新密码，必须包括英文、数字、特殊字符等</div><div class="line">ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;root&apos;;</div><div class="line"></div><div class="line">//5.6版本</div><div class="line">mysql -u root</div><div class="line">set password for &apos;root&apos;@&apos;localhost&apos; =password(&apos;root&apos;);</div></pre></td></tr></table></figure></p>
<p><strong>6. 编码</strong><br>在/etc/my.cnf末尾添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[mysql]</div><div class="line">default-character-set = utf8</div></pre></td></tr></table></figure></p>
<p>修改远程连接设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; grant all privileges on *.* to root@&apos;%&apos;identified by &apos;new password&apos;;</div></pre></td></tr></table></figure></p>
<p><strong>7. 创建名为ghost的用户并新建名为ghost的数据库，同时给ghost用户授予ghost数据库的所有权限</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CREATE DATABASE ghost; </div><div class="line">GRANT ALL PRIVILEGES ON ghost.* To &apos;ghost&apos;@&apos;127.0.0.1&apos; IDENTIFIED BY &apos;为ghost用户设置一个与root不同的密码&apos;;</div></pre></td></tr></table></figure></p>
<p>###编译安装node.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">wget http://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz</div><div class="line">tar zxvf node-v0.10.40.tar.gz</div><div class="line">rm node-v0.10.40.tar.gz</div><div class="line">cd node-v0.10.40</div><div class="line">./configure</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure></p>
<p>###编译安装nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install nginx</div></pre></td></tr></table></figure></p>
<p>###运行nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl enable nginx</div><div class="line">systemctl start nginx</div></pre></td></tr></table></figure></p>
<h3 id="配置-Nginx-的反向代理"><a href="#配置-Nginx-的反向代理" class="headerlink" title="配置 Nginx 的反向代理"></a>配置 Nginx 的反向代理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">vi /etc/nginx/conf.d/default.conf</div><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name reedw.me(填写博客地址)</div><div class="line">    location / &#123;</div><div class="line">        proxy_set_header   X-Real-IP $remote_addr;</div><div class="line">        proxy_set_header   Host      $http_host;</div><div class="line">        proxy_pass         http://127.0.0.1:2368;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###重新启动 Nginx 服务器,让设置生效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart nginx</div></pre></td></tr></table></figure></p>
<p>###修改服务器时间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install -y ntp</div><div class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div></pre></td></tr></table></figure></p>
<p>###安装Ghost<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /srv/www/</div><div class="line">wget http://dl.ghostchina.com/Ghost-0.7.4-zh-full.zip</div><div class="line">unzip -d ghost Ghost-0.7.4-zh-full.zip //解压</div><div class="line">cd /srv/www/ghost</div></pre></td></tr></table></figure></p>
<p>###编辑ghost的配置文件<br>我们进入 Ghost 系统目录，为 Ghost 增加配置文件并配置数据库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">cd /srv/www/ghost</div><div class="line">cp config.example.js config.js</div><div class="line">vi config.js</div><div class="line"></div><div class="line">production: &#123; </div><div class="line"></div><div class="line">    url: &apos;http://reedw.me&apos;, //你的blog地址</div><div class="line">    mail: &#123;&#125;,</div><div class="line">    database: &#123;</div><div class="line">        client: &apos;mysql&apos;,</div><div class="line">        connection: &#123;</div><div class="line">            host     : &apos;127.0.0.1&apos;, </div><div class="line">            user     : &apos;root&apos;, </div><div class="line">            password : &apos;root&apos;, </div><div class="line">            database : &apos;ghost&apos;,</div><div class="line">            charset  : &apos;utf8&apos;</div><div class="line">    &#125;,</div><div class="line">        debug: false</div><div class="line">    &#125;,</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p>###以生产模式运行 Ghost<br>安装forever<br>npm install forever -g<br>运行ghost<br>cd /srv/www/ghost<br>NODE_ENV=production forever start index.js</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/14/搭建翻墙服务器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/搭建翻墙服务器/" itemprop="url">
                  搭建翻墙服务器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T00:28:02+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###安装pip<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;</div><div class="line">$ python get-pip.py</div></pre></td></tr></table></figure></p>
<p>###安装shadowsocks<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ pip install --upgrade pip</div><div class="line">$ pip install shadowsocks</div></pre></td></tr></table></figure></p>
<p>###创建配置文件/etc/shadowsocks.json<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;server&quot;:&quot;0.0.0.0&quot;,</div><div class="line">    &quot;local_address&quot;: &quot;127.0.0.1&quot;,</div><div class="line">    &quot;local_port&quot;:1080,</div><div class="line">    &quot;port_password&quot;:&#123;</div><div class="line">    &quot;8388&quot;:&quot;you can set password here&quot;</div><div class="line">    &#125;,</div><div class="line">    &quot;timeout&quot;:300,</div><div class="line">    &quot;method&quot;:&quot;aes-256-cfb&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###配置自启动<br>新建启动脚本文件/etc/systemd/system/shadowsocks.service<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[Unit]</div><div class="line">Description=Shadowsocks</div><div class="line"></div><div class="line">[Service]</div><div class="line">TimeoutStartSec=0</div><div class="line">ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=multi-user.target</div></pre></td></tr></table></figure></p>
<p>执行以下命令启动shadosocks服务：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ systemctl enable shadowsocks</div><div class="line">$ systemctl start shadowsocks</div></pre></td></tr></table></figure></p>
<p>可以通过以下命令查看服务是否成功启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ systemctl status shadowsocks -l</div></pre></td></tr></table></figure></p>
<p>###防火墙开放shadowsocks服务端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --permanent --add-port=8388/tcp</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/14/Android中设置功能的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/Android中设置功能的实现/" itemprop="url">
                  Android中设置功能的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T00:27:34+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###前言<br>&emsp;&emsp;在 Android 应用开发过程，多多少少会碰到应用设置的问题，一开始的想法肯定是使用 view 对象构建用户界面，但是 Google 表示这种做法太不友好，应当使用 Android 的 Preference API 构建一个与其他 Android 应用中的用户体验一致的界面（包括系统设置）。</p>
<p>###布局视图<br>&emsp;&emsp;官方说法是定义首选项，我觉得说成布局设置界面视图更合适。</p>
<p>&emsp;&emsp;按照官方指导，首先需要在 res/xml 目录下定义一个xml文件，通常命名为preferences.xml（可以更改命名）。XML 文件的根节点必须是一个 &lt;PreferenceScreen&gt; 元素，可以在此元素内添加每个 &lt;Preference&gt;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;PreferenceScreen xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</div><div class="line"></div><div class="line">    &lt;CheckBoxPreference</div><div class="line">        android:defaultValue=&quot;true&quot;</div><div class="line">        android:key=&quot;checkbox&quot;</div><div class="line">        android:title=&quot;checkbox&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;PreferenceScreen</div><div class="line">        android:key=&quot;scree&quot;</div><div class="line">        android:title=&quot;screen&quot;</div><div class="line">        android:persistent=&quot;false&quot;&gt;</div><div class="line"></div><div class="line">        &lt;SwitchPreference</div><div class="line">            android:key=&quot;switch&quot;</div><div class="line">            android:title=&quot;switch&quot; /&gt;</div><div class="line"></div><div class="line">        &lt;ListPreference</div><div class="line">            android:defaultValue=&quot;1&quot;</div><div class="line">            android:entries=&quot;@array/str_arr&quot;</div><div class="line">            android:entryValues=&quot;@array/str_arr&quot;</div><div class="line">            android:key=&quot;list&quot;</div><div class="line">            android:title=&quot;list&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;/PreferenceScreen&gt;</div><div class="line"></div><div class="line">    &lt;PreferenceCategory</div><div class="line">        android:key=&quot;category&quot;</div><div class="line">        android:title=&quot;category&quot;&gt;</div><div class="line"></div><div class="line">        &lt;EditTextPreference</div><div class="line">            android:key=&quot;edit&quot;</div><div class="line">            android:title=&quot;edit&quot; /&gt;</div><div class="line"></div><div class="line">        &lt;MultiSelectListPreference</div><div class="line">            android:key=&quot;multi&quot;</div><div class="line">            android:title=&quot;multi&quot;</div><div class="line">            android:entries=&quot;@array/str_arr&quot;</div><div class="line">            android:entryValues=&quot;@array/str_arr&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;/PreferenceCategory&gt;</div><div class="line"></div><div class="line">    &lt;Preference android:title=&quot;preference&quot; &gt;</div><div class="line">        &lt;intent android:action=&quot;android.intent.action.VIEW&quot;</div><div class="line">            android:data=&quot;http://www.example.com&quot; /&gt;</div><div class="line">    &lt;/Preference&gt;</div><div class="line"></div><div class="line">&lt;/PreferenceScreen&gt;</div></pre></td></tr></table></figure></p>
<p>这些元素有不同的属性，其中以下三个属性是通用的：</p>
<ul>
<li><p>android:key</p>
<p>对于要保留数据值的首选项，必须拥有此属性。它指定系统在将此设置的值保存在 SharedPreferences 中时所用的唯一键（字符串）。不需要此属性的仅有情形是：首选项是 PreferenceCategory 或PreferenceScreen，或者首选项指定要调用的 Intent（使用 &lt;intent&gt; 元素）或要显示的 Fragment（使用 android:fragment 属性）。</p>
</li>
<li><p>android:title</p>
<p>此属性为设置提供用户可见的名称。</p>
</li>
<li><p>android:defaultValue</p>
<p>此属性指定系统应该在 SharedPreferences 文件中设置的初始值。您应该为所有设置提供默认值。</p>
</li>
</ul>
<p>&emsp;&emsp;当设置的选项过多时，为了方便用户查看，我们一般会对选项进行分组。分组的形式一般分为两种，一种是使用标题，一种是使用子屏幕（即打开一个新的界面）</p>
<ul>
<li><p>使用标题</p>
<p>利用&lt;PreferenceCategory&gt;标签可以实现如图的效果:<br><img src="http://ww2.sinaimg.cn/large/af7c282fgw1f5uquycopoj20ls0fot92.jpg" alt=""></p>
</li>
<li><p>使用子屏幕</p>
<p>利用&lt;PreferenceScreen&gt;标签可以实现如图效果：</p>
<p><img src="http://ww1.sinaimg.cn/large/af7c282fgw1f5urdmp216j20ls0jijs5.jpg" alt=""></p>
<p><img src="http://ww2.sinaimg.cn/large/af7c282fgw1f5ure3zyoqj20oq142abw.jpg" alt=""></p>
</li>
</ul>
<p>具体实现代码见上方代码块</p>
<p>###值的获取</p>
<p>想要获取设置项的值，可以通过以下代码实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(this);</div><div class="line">//T t = pref.getXXX(key, defaultValue);</div><div class="line">String str = pref.getString(&quot;edit&quot;, &quot;&quot;);</div></pre></td></tr></table></figure></p>
<p>同时，可以实时监控设置项值的变化，利用以下代码:</p>
<p>首先继承OnSharedPreferenceChangeListener接口，在onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key)实现当值发生变化时需要做的操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String key) &#123;</div><div class="line">        Log.i(&quot;===========&gt;&gt;&gt;&gt;&gt;&gt;&quot;, key);</div><div class="line">        Log.i(&quot;===========&gt;&gt;&gt;&gt;&gt;&gt;&quot;, (findPreference(key) instanceof CheckBoxPreference) + &quot;&quot;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>###可能会用到的方法</p>
<ul>
<li><p><strong>实现设置项各个点击事件</strong></p>
<p>findPreference(key).setOnPreferenceClickListener(……);</p>
<p>或者</p>
<p>实现接口OnPreferenceClickListener</p>
</li>
</ul>
<p>###备注</p>
<ul>
<li>如果想要实现Material Design风格的设置界面，可以参考<a href="https://drakeet.me/material-design-settings-activity" target="_blank" rel="external">此博客</a></li>
<li>其他用法参考<a href="https://developer.android.com/guide/topics/ui/settings.html" target="_blank" rel="external">官方指导文档</a> (需要科学上网)</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/14/Android中利用volley同时上传文件和文本参数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/Android中利用volley同时上传文件和文本参数/" itemprop="url">
                  Android中利用volley同时上传文件和文本参数
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T00:27:10+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>前言</strong></p>
<p>在做项目时利用了Volley网络库与服务器之间进行通信，但Volley并没有现成的上传文件的Request可以调用，网上搜索一圈发现很多都是基于HttpClient进行自定义Request封装，可是无奈android 6.0之后移除了HttpClient的代码，只能自己基于HttpURLConnection封装一个Request使用。</p>
<p><strong>继承Request，重写一些方法</strong></p>
<p>由于我的项目中服务器返回的结果都是json格式，所以我自定义一个返回结果是json格式的request，你也可以换成String格式，或者其他你需要的格式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class PostUploadRequest extends Request&lt;JSONObject&gt;&#123;</div><div class="line"></div><div class="line">public PostUploadRequest(String url, Map&lt;String, String[]&gt; fileMap, Response.Listener&lt;JSONObject&gt; mListener, Response.ErrorListener listener) &#123;</div><div class="line">        super(Method.POST, url, listener);</div><div class="line">        this.mListener = mListener;</div><div class="line">        this.fileMap = fileMap;</div><div class="line">        setShouldCache(false);</div><div class="line">        setRetryPolicy(new DefaultRetryPolicy(5000, DefaultRetryPolicy.DEFAULT_MAX_RETRIES, DefaultRetryPolicy.DEFAULT_BACKOFF_MULT));</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>重写parseNetworkResponse（）方法</strong></p>
<p>将返回结果转换成json格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">try &#123;</div><div class="line">   String je = new String(response.data, HttpHeaderParser.parseCharset(response.headers));</div><div class="line">   return Response.success(new JSONObject(je), HttpHeaderParser.parseCacheHeaders(response));</div><div class="line">&#125; catch (UnsupportedEncodingException var3) &#123;</div><div class="line">    return Response.error(new ParseError(var3));</div><div class="line">&#125; catch (JSONException var4) &#123;</div><div class="line">    return Response.error(new ParseError(var4));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>重写deliverResponse（）方法</strong></p>
<p>为请求添加监听回调事件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    protected void deliverResponse(JSONObject jsonObject) &#123;</div><div class="line">        mListener.onResponse(jsonObject);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>模仿浏览器上传文件请求</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">private void buildFilePart(DataOutputStream ds) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        Object[] key_arr = fileMap.keySet().toArray();</div><div class="line">        for (Object name : key_arr) &#123;</div><div class="line">            String[] val = fileMap.get(name.toString());</div><div class="line">            String path = val[0];</div><div class="line">            String filename = val[1];</div><div class="line">            try &#123;</div><div class="line">                sb.append(prefix);</div><div class="line">                sb.append(boundary);</div><div class="line">                sb.append(end);</div><div class="line">                sb.append(&quot;Content-Disposition: form-data;name=\&quot;&quot;);</div><div class="line">                sb.append(name.toString());</div><div class="line">                sb.append(&quot;\&quot;;filename=\&quot;&quot;);</div><div class="line">                sb.append(filename);</div><div class="line">                sb.append(&quot;\&quot;&quot; + end);//filename是文件名，如xxx.jpg，file是服务器传递参数的名字</div><div class="line">                sb.append(&quot;Content-Type: application/octet-stream;charset=UTF-8&quot; + end);</div><div class="line">                sb.append(end);</div><div class="line">                ds.write(sb.toString().getBytes(&quot;UTF-8&quot;));</div><div class="line">                /* 取得文件的FileInputStream */</div><div class="line">                FileInputStream fStream = new FileInputStream(path);//path是文件本地地址</div><div class="line">                /* 设置每次写入1024bytes */</div><div class="line">                int bufferSize = 1024;</div><div class="line">                byte[] buffer = new byte[bufferSize];</div><div class="line">                int length;</div><div class="line">                /* 从文件读取数据至缓冲区 */</div><div class="line">                while ((length = fStream.read(buffer)) != -1) &#123;</div><div class="line">                    /* 将资料写入DataOutputStream中 */</div><div class="line">                    ds.write(buffer, 0, length);</div><div class="line">                &#125;</div><div class="line">                ds.write(end.getBytes(&quot;UTF-8&quot;));</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>模仿浏览器传递普通参数请求</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">private void buildTextPart(DataOutputStream ds) &#123;</div><div class="line">        try &#123;</div><div class="line">            Map&lt;String, String&gt; map = getParams();</div><div class="line">            Object[] key_arr = map.keySet().toArray();</div><div class="line">            for (Object name : key_arr) &#123;</div><div class="line">                String val = map.get(name.toString());</div><div class="line">                ds.write((prefix + boundary + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((&quot;Content-Disposition: form-data;name=\&quot;&quot; + name.toString() + &quot;\&quot;&quot; + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((&quot;Content-Type: text/plain;charset=UTF-8&quot; + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((val + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">            &#125;</div><div class="line">        &#125; catch (IOException | AuthFailureError e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>重写getBody（）方法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    public byte[] getBody() throws AuthFailureError &#123;</div><div class="line">        try &#123;</div><div class="line">            ByteArrayOutputStream bos = new ByteArrayOutputStream();</div><div class="line">            DataOutputStream ds = new DataOutputStream(bos);</div><div class="line">            buildTextPart(ds);</div><div class="line">            buildFilePart(ds);</div><div class="line">            ds.write((prefix + boundary + prefix + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">            ds.flush();</div><div class="line">            return bos.toByteArray();</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>使用</strong></p>
<p>和正常使用volley提供的request一样使用，不同的是构造方法中传递参数有略微不同，传递参数中<code>Map&lt;String,String[]&gt; fileMap</code><br>key存放的是参数名<br>value是长度为2的字符串数组， 下标0存放的是文件的本地路径，下标1存放的是传送到服务器中的文件名，通过fileMap可以一次性上传多个参数，如果需要同时上传普通文本参数，可以在构造request是重写getParams()方法以<code>Map&lt;String,String&gt;</code> 形式传递多个文本参数和参数值，类似StringRequest. 示例代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Response.Listener&lt;JSONObject&gt; listener = new Response.Listener&lt;JSONObject&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public void onResponse(JSONObject jsonObject) &#123;</div><div class="line">                //请求成功后的处理</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        Response.ErrorListener errorListener = new Response.ErrorListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onErrorResponse(VolleyError volleyError) &#123;</div><div class="line">                //请求失败后的处理</div><div class="line">        &#125;;</div><div class="line">        PostUploadRequest request = new PostUploadRequest(url, fileMap, listener, errorListener) &#123;</div><div class="line">            @Override</div><div class="line">            protected Map&lt;String, String&gt; getParams() throws AuthFailureError &#123;</div><div class="line">                return map;//map存放的是普通参数</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        //RequestQueue.add(request)</div><div class="line">        //发起请求</div></pre></td></tr></table></figure>
<p>以下是request的完整代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line">public class PostUploadRequest extends Request&lt;JSONObject&gt; &#123;</div><div class="line"></div><div class="line">    private final String prefix = &quot;--&quot;;</div><div class="line">    private final String end = &quot;\r\n&quot;;</div><div class="line">    private final String boundary = &quot;--------------&quot; + System.currentTimeMillis();</div><div class="line">    private final String mimeType = &quot;multipart/form-data;boundary=&quot; + boundary;</div><div class="line">    private Response.Listener&lt;JSONObject&gt; mListener;</div><div class="line">    private Map&lt;String, String[]&gt; fileMap;</div><div class="line"></div><div class="line">    public PostUploadRequest(String url, Map&lt;String, String[]&gt; fileMap, Response.Listener&lt;JSONObject&gt; mListener, Response.ErrorListener listener) &#123;</div><div class="line">        super(Method.POST, url, listener);</div><div class="line">        this.mListener = mListener;</div><div class="line">        this.fileMap = fileMap;</div><div class="line">        setShouldCache(false);</div><div class="line">        setRetryPolicy(new DefaultRetryPolicy(5000, DefaultRetryPolicy.DEFAULT_MAX_RETRIES, DefaultRetryPolicy.DEFAULT_BACKOFF_MULT));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected Response&lt;JSONObject&gt; parseNetworkResponse(NetworkResponse response) &#123;</div><div class="line">        try &#123;</div><div class="line">            String je = new String(response.data, HttpHeaderParser.parseCharset(response.headers));</div><div class="line">            return Response.success(new JSONObject(je), HttpHeaderParser.parseCacheHeaders(response));</div><div class="line">        &#125; catch (UnsupportedEncodingException var3) &#123;</div><div class="line">            return Response.error(new ParseError(var3));</div><div class="line">        &#125; catch (JSONException var4) &#123;</div><div class="line">            return Response.error(new ParseError(var4));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void deliverResponse(JSONObject jsonObject) &#123;</div><div class="line">        mListener.onResponse(jsonObject);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String getBodyContentType() &#123;</div><div class="line">        return mimeType;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public byte[] getBody() throws AuthFailureError &#123;</div><div class="line">        try &#123;</div><div class="line">            ByteArrayOutputStream bos = new ByteArrayOutputStream();</div><div class="line">            DataOutputStream ds = new DataOutputStream(bos);</div><div class="line">            buildTextPart(ds);</div><div class="line">            buildFilePart(ds);</div><div class="line">            ds.write((prefix + boundary + prefix + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">            ds.flush();</div><div class="line">            return bos.toByteArray();</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        return null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void buildFilePart(DataOutputStream ds) &#123;</div><div class="line">        StringBuilder sb = new StringBuilder();</div><div class="line">        Object[] key_arr = fileMap.keySet().toArray();</div><div class="line">        for (Object name : key_arr) &#123;</div><div class="line">            String[] val = fileMap.get(name.toString());</div><div class="line">            String path = val[0];</div><div class="line">            String filename = val[1];</div><div class="line">            try &#123;</div><div class="line">                sb.append(prefix);</div><div class="line">                sb.append(boundary);</div><div class="line">                sb.append(end);</div><div class="line">                sb.append(&quot;Content-Disposition: form-data;name=\&quot;&quot;);</div><div class="line">                sb.append(name.toString());</div><div class="line">                sb.append(&quot;\&quot;;filename=\&quot;&quot;);</div><div class="line">                sb.append(filename);</div><div class="line">                sb.append(&quot;\&quot;&quot; + end);//filename是文件名，如xxx.jpg，file是服务器传递参数的名字</div><div class="line">                sb.append(&quot;Content-Type: application/octet-stream;charset=UTF-8&quot; + end);</div><div class="line">                sb.append(end);</div><div class="line">                ds.write(sb.toString().getBytes(&quot;UTF-8&quot;));</div><div class="line">                /* 取得文件的FileInputStream */</div><div class="line">                FileInputStream fStream = new FileInputStream(path);//path是文件本地地址</div><div class="line">                /* 设置每次写入1024bytes */</div><div class="line">                int bufferSize = 1024;</div><div class="line">                byte[] buffer = new byte[bufferSize];</div><div class="line">                int length;</div><div class="line">                /* 从文件读取数据至缓冲区 */</div><div class="line">                while ((length = fStream.read(buffer)) != -1) &#123;</div><div class="line">                    /* 将资料写入DataOutputStream中 */</div><div class="line">                    ds.write(buffer, 0, length);</div><div class="line">                &#125;</div><div class="line">                ds.write(end.getBytes(&quot;UTF-8&quot;));</div><div class="line">            &#125; catch (IOException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void buildTextPart(DataOutputStream ds) &#123;</div><div class="line">        try &#123;</div><div class="line">            Map&lt;String, String&gt; map = getParams();</div><div class="line">            Object[] key_arr = map.keySet().toArray();</div><div class="line">            for (Object name : key_arr) &#123;</div><div class="line">                String val = map.get(name.toString());</div><div class="line">                ds.write((prefix + boundary + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((&quot;Content-Disposition: form-data;name=\&quot;&quot; + name.toString() + &quot;\&quot;&quot; + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((&quot;Content-Type: text/plain;charset=UTF-8&quot; + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((end).getBytes(&quot;UTF-8&quot;));</div><div class="line">                ds.write((val + end).getBytes(&quot;UTF-8&quot;));</div><div class="line">            &#125;</div><div class="line">        &#125; catch (IOException | AuthFailureError e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>一些话</strong></p>
<ol>
<li>第一次写博客，可能格式内容上比较粗糙，欢迎各位批评指正</li>
<li>代码上的实现主要是为了手上项目，通用性上可能会有所欠缺，如果使用过程中出现bug或者有一些疑问，欢迎评论指出，或者联系我的邮箱：13813005628@163.com</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/14/关于Retrofit 2.0的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/关于Retrofit 2.0的使用/" itemprop="url">
                  关于Retrofit 2.0的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T00:26:41+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##前言</p>
<p>前不久retrofit 2.0正式发布，一直很想试试看这款很火的网络库，所以最近有点时间稍微研究了下retrofit 2.0的使用。苦于网上虽然有很多相关教程，但是很少有代码示例和使用说明，所以，我写点自己对于retrofit使用上的理解，并附上自己的demo源码。</p>
<p>##配置</p>
<p>在工程里添加网络访问权限是必须的，所以在AndroidManifest.xml中添加如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</div></pre></td></tr></table></figure>
<p>在app/build.gradle引入下列库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">compile &apos;com.squareup.retrofit2:retrofit:2.0.0&apos;</div><div class="line">compile &apos;com.squareup.retrofit2:converter-gson:2.0.0&apos;</div><div class="line">compile &apos;com.squareup.retrofit2:converter-scalars:2.0.0&apos;</div><div class="line">compile &apos;com.squareup.okhttp3:okhttp:3.0.0&apos;</div><div class="line">compile &apos;com.google.code.gson:gson:2.5&apos;</div></pre></td></tr></table></figure>
<p>coverter-gson可以方便的把返回结果转成对象模型，而converter-scalars则可以把返回结果转成String。<br>如果需要将返回数据转成其他类型，也可以引入其他一些包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">compile &apos;com.squareup.retrofit2:converter-jackson&apos;</div><div class="line">compile &apos;com.squareup.retrofit2:converter-moshi&apos;</div><div class="line">compile &apos;com.squareup.retrofit2:converter-protobuf&apos;</div><div class="line">compile &apos;com.squareup.retrofit2:converter-wire&apos;</div><div class="line">compile &apos;com.squareup.retrofit2:converter-simplexml&apos;</div></pre></td></tr></table></figure>
<p>##使用</p>
<p><strong>定义一个接口，用于http请求</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public interface GitHubService &#123;</div><div class="line"></div><div class="line">    @GET(&quot;users&quot;)</div><div class="line">    Call&lt;String&gt; listRepos();</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 参数比较少的情况下，可以直接传出参数名和参数值</div><div class="line">     * @param page 参数值</div><div class="line">     * @return 返回请求</div><div class="line">     */</div><div class="line">    @GET(&quot;repositories/892275/contributors&quot;)</div><div class="line">    Call&lt;String&gt; repos(@Query(&quot;page&quot;)int page);</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 参数比较多时，可以以map的形式传入参数名和值</div><div class="line">     * @param options 参数Map</div><div class="line">     * @return 返回请求</div><div class="line">     */</div><div class="line">    @GET(&quot;user/repos&quot;)</div><div class="line">    Call&lt;String&gt; getRequestWithMap(@QueryMap Map&lt;String, String&gt; options);</div><div class="line"></div><div class="line">    @FormUrlEncoded</div><div class="line">    @POST(&quot;/some/endpoint&quot;)</div><div class="line">    Call&lt;String&gt; getPostWithMap(@FieldMap Map&lt;String, String&gt; names);</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 其他的一些使用方式可以参考官方使用说明</div><div class="line">     * http://square.github.io/retrofit/</div><div class="line">     */</div></pre></td></tr></table></figure>
<p><strong>创建Retrofit 实例</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Retrofit retrofit = new Retrofit.Builder()</div><div class="line">                            .baseUrl(&quot;https://api.github.com/&quot;)</div><div class="line">                            //解析结果为需要的类型</div><div class="line">                            .addConverterFactory(ScalarsConverterFactory.create())</div><div class="line">                            .addConverterFactory(GsonConverterFactory.create())</div><div class="line">                            .build();</div></pre></td></tr></table></figure>
<p><strong>发起请求</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">GithubService service = getInstance().create(GitHubService.class);</div><div class="line">Call&lt;String&gt; repos = service.listRepos();</div><div class="line">        repos.enqueue(new Callback&lt;String&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public void onResponse(Call&lt;String&gt; call, retrofit2.Response&lt;String&gt; response) &#123;</div><div class="line">                String str = response.body();</div><div class="line">                text.setText(str);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onFailure(Call&lt;String&gt; call, Throwable t) &#123;</div><div class="line">                Log.i(&quot;info&quot;,t.getMessage());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure>
<p>##注意事项</p>
<ol>
<li>baseUrl以“/结尾”，多为域名，而@URL则不以“/”</li>
<li>文中仅列举了两个get请求的方式，其他请求方式参照官网介绍<a href="http://square.github.io/retrofit/" target="_blank" rel="external">Retrofit 官方介绍</a></li>
<li>初次接触retrofit，不足之处还望见谅，后续对retrofit有新的见解将更新此文</li>
<li>demo地址：<a href="https://github.com/ReedGit/RetrofitDemo" target="_blank" rel="external">RetrofitDemo</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/14/Android应用中分享到微信好友和朋友圈的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/Android应用中分享到微信好友和朋友圈的实现/" itemprop="url">
                  Android 应用中分享到微信好友和朋友圈的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T00:26:11+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>前言</strong></p>
<p>实现分享到微信好友和朋友圈的功能其实很简单，官方文档其实还是比较详细的，只是在创建应用的过程比较费（dan）事（teng），好在微信的审核效率还可以，所以这篇博客简单为大家介绍下这个功能的实现，同时方便自己日后查看。话不多说，下面进入正题。</p>
<p><strong>申请AppID</strong></p>
<p>这部分大家去微信开发者平台注册账号按照提示创建应用就好了，<a href="https://open.weixin.qq.com/cgi-bin/frame?t=home/app_tmpl&amp;lang=zh_CN" target="_blank" rel="external">这里是开发者平台的地址</a>。这里要注意的是创建应用是需要提供应用的签名，大家可以在<a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419319167&amp;token=&amp;lang=zh_CN" target="_blank" rel="external">链接</a>里下载签名生成工具安装在手机上获得。</p>
<p><strong>引入jar包</strong></p>
<p>在<a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419319167&amp;lang=zh_CN" target="_blank" rel="external">官方资源下载页</a>下载jar包，然后将包导入工程。</p>
<p><strong>在AndroidManifest.xml中添加权限</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;</div><div class="line">&lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;</div></pre></td></tr></table></figure>
<p><strong>注册到微信</strong></p>
<p>要使你的程序启动后微信终端能响应你的程序，必须在代码中你需要的位置向微信终端注册你的id。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//注册应用id到微信</div><div class="line">private void regToWx() &#123;</div><div class="line">    //通过WXAPIFactory工厂，获取IWXAPI的实例</div><div class="line">    api = WXAPIFactory.createWXAPI(context, APP_ID, true);</div><div class="line">    //将应用的appId注册到微信</div><div class="line">    api.registerApp(APP_ID);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>分享</strong></p>
<p> 1.分享文字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 分享文字到朋友圈或者好友</div><div class="line"> *</div><div class="line"> * @param text  文本内容</div><div class="line"> * @param scene 分享方式：好友还是朋友圈</div><div class="line"> */</div><div class="line">public boolean shareText(String text, int scene) &#123;</div><div class="line">    //初始化一个WXTextObject对象，填写分享的文本对象</div><div class="line">    WXTextObject textObj = new WXTextObject();</div><div class="line">    textObj.text = text;</div><div class="line">    return share(textObj, text, scene);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 2.分享图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 分享图片到朋友圈或者好友</div><div class="line"> *</div><div class="line"> * @param bmp   图片的Bitmap对象</div><div class="line"> * @param scene 分享方式：好友还是朋友圈</div><div class="line"> */</div><div class="line">public boolean sharePic(Bitmap bmp, int scene) &#123;</div><div class="line">    //初始化一个WXImageObject对象</div><div class="line">    WXImageObject imageObj = new WXImageObject(bmp);</div><div class="line">    //设置缩略图</div><div class="line">    Bitmap thumb = Bitmap.createScaledBitmap(bmp, 60, 60, true);</div><div class="line">    bmp.recycle();</div><div class="line">    return share(imageObj, bmp, scene);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3.分享网页</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 分享网页到朋友圈或者好友，视频和音乐的分享和网页大同小异，只是创建的对象不同。</div><div class="line"> * 详情参考官方文档：</div><div class="line"> * https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419317340&amp;token=&amp;lang=zh_CN</div><div class="line"> *</div><div class="line"> * @param url         网页的url</div><div class="line"> * @param title       显示分享网页的标题</div><div class="line"> * @param description 对网页的描述</div><div class="line"> * @param scene       分享方式：好友还是朋友圈</div><div class="line"> */</div><div class="line">public boolean shareUrl(String url, String title, Bitmap thumb, String description, int scene) &#123;</div><div class="line">    //初试话一个WXWebpageObject对象，填写url</div><div class="line">    WXWebpageObject webPage = new WXWebpageObject();</div><div class="line">    webPage.webpageUrl = url;</div><div class="line">    return share(webPage, title, thumb, description, scene);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中share的重载函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">private boolean share(WXMediaMessage.IMediaObject mediaObject, Bitmap thumb, int scene) &#123;</div><div class="line">        return share(mediaObject, null, thumb, null, scene);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">private boolean share(WXMediaMessage.IMediaObject mediaObject, String description, int scene) &#123;</div><div class="line">    return share(mediaObject, null, null, description, scene);</div><div class="line">&#125;</div><div class="line"></div><div class="line">private boolean share(WXMediaMessage.IMediaObject mediaObject, String title, Bitmap thumb, String description, int scene) &#123;</div><div class="line">    //初始化一个WXMediaMessage对象，填写标题、描述</div><div class="line">    WXMediaMessage msg = new WXMediaMessage(mediaObject);</div><div class="line">    if (title != null) &#123;</div><div class="line">        msg.title = title;</div><div class="line">    &#125;</div><div class="line">    if (description != null) &#123;</div><div class="line">        msg.description = description;</div><div class="line">    &#125;</div><div class="line">    if (thumb != null) &#123;</div><div class="line">        msg.thumbData = bmpToByteArray(thumb, true);</div><div class="line">    &#125;</div><div class="line">    //构造一个Req</div><div class="line">    SendMessageToWX.Req req = new SendMessageToWX.Req();</div><div class="line">    req.transaction = String.valueOf(System.currentTimeMillis());</div><div class="line">    req.message = msg;</div><div class="line">    req.scene = scene;</div><div class="line">    return api.sendReq(req);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>####注：如果是分享到朋友圈，scene = SendMessageToWX.Req.WXSceneTimeline；如果分享到好友， scene = SendMessageToWX.Req.WXSceneSession。</p>
<p><strong>判断是否支持分享到朋友圈</strong></p>
<p>只有微信4.2以上支持，如果需要检查微信版本支持API的情况， 可调用IWXAPI的getWXAppSupportAPI方法,0x21020001及以上支持发送朋友圈</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//判断是否支持转发到朋友圈</div><div class="line">//微信4.2以上支持，如果需要检查微信版本支持API的情况， 可调用IWXAPI的getWXAppSupportAPI方法,0x21020001及以上支持发送朋友圈</div><div class="line">public boolean isSupportWX() &#123;</div><div class="line">    int wxSdkVersion = api.getWXAppSupportAPI();</div><div class="line">    return wxSdkVersion &gt;= TIMELINE_SUPPORTED_VERSION;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>微信返回值的接收</strong></p>
<p>如果需要对分享的结果进行处理，那么就需要对微信的返回值进行判断。问题来了，如何获取微信的返回值呢？</p>
<ol>
<li>在你的包名相应目录下新建一个wxapi目录，并在该wxapi目录下新增一个WXEntryActivity类，该类继承自Activity，并在manifest文件里面加上exported属性，设置为true。</li>
<li>实现IWXAPIEventHandler接口，微信发送的请求将回调到onReq方法，发送到微信请求的响应结果将回调到onResp方法，此处我们用到的是onResp方法。</li>
<li>在WXEntryActivity中将接收到的intent及实现了IWXAPIEventHandler接口的对象传递给IWXAPI接口的handleIntent方法。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">IWXAPI api = WXAPIFactory.createWXAPI(this, WeChatShareUtil.APP_ID, false);</div><div class="line">api.handleIntent(getIntent(),this);</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>项目地址</strong></p>
<p>源码我已上传至本人的<a href="https://github.com/ReedGit/WeChatShareDemo" target="_blank" rel="external">Github</a>，欢迎访问指导</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/14/RecyclerView的痛点使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Reed">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Reed">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/RecyclerView的痛点使用/" itemprop="url">
                  RecyclerView的痛点使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-14T00:25:37+08:00">
                2016-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##前言</p>
<p>申明：这里不提供封装好的RecylerView库，碍于作者能力，只能提供一些思路和想法。同时，这不是一篇基础性的RecylerView的使用文章，文章中我将主要对我本人在使用过程遇到的通点进行归纳，并提供自己的解决方法。<br>众所周知，在Android 5.0之后，Google引入Material Design设计，同时为我们带来了ListView的替代品RecylerView。对比ListView, RecyclerView在可扩展性，灵活性上更方便我们自己去定制。话不多说，下面我将从<strong>下拉刷新</strong>、<strong>上拉加载更多</strong>、<strong>自定义分割线</strong>、<strong>item点击事件</strong>阐述我的跟人想法。</p>
<p>##下拉刷新</p>
<p>本着用最简便的方式实现需求的原则，我们在下拉刷新这块主要是借助Google提供的SwipeRefreshLayout控件。<br>SwipeRefreshLayout使用起来很简单，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;android.support.v4.widget.SwipeRefreshLayout</div><div class="line">        android:id=&quot;@+id/refresh&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;&gt;</div><div class="line"></div><div class="line">        &lt;android.support.v7.widget.RecyclerView</div><div class="line">            android:id=&quot;@+id/recyclerView&quot;</div><div class="line">            android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;match_parent&quot;</div><div class="line">            android:clipToPadding=&quot;false&quot;</div><div class="line">            android:paddingLeft=&quot;16dp&quot;</div><div class="line">            android:paddingRight=&quot;16dp&quot;</div><div class="line">            android:paddingTop=&quot;16dp&quot; /&gt;</div><div class="line"></div><div class="line">&lt;/android.support.v4.widget.SwipeRefreshLayout&gt;</div></pre></td></tr></table></figure>
<p>实现下拉刷新，只需要调用SwipeRefreshLayout的监听事件OnRefreshListener，在监听事件方法里实现响应的逻辑就行了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">mRefresh.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() &#123;</div><div class="line">    @Override</div><div class="line">    public void onRefresh() &#123;</div><div class="line">        new Handler().postDelayed(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                texts.clear();</div><div class="line">                i = 0;</div><div class="line">                setData();</div><div class="line">                mAdapter.notifyDataSetChanged();</div><div class="line">                mRefresh.setRefreshing(false);</div><div class="line">            &#125;</div><div class="line">        &#125;,2000);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>##自定义分割线</p>
<p>使用RecyclerView时，为了控制item之间的距离，我们既可以通过设置item的margin调整item之间的距离，也可以调用RecyclerView的addItemDecoration()方法设置分割线来控制item之间的距离。这里我们使用的是后者。<br>我们需要自定义一个分割线类继承自RecyclerView.ItemDecoration，重写onDraw()方法（绘制分割线）以及getItemOffsets()方法（设置分割线的大小）。<br>此处给出我的自定义分割线源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">public class DividerItemDecoration extends RecyclerView.ItemDecoration &#123;</div><div class="line"></div><div class="line">    private int orientation;</div><div class="line"></div><div class="line">    //转换成整型后分割线尺寸</div><div class="line">    private int itemSize;</div><div class="line">    //待传入的分割线尺寸，如果没有传入，初始化的时候默认16</div><div class="line">    private float size;</div><div class="line"></div><div class="line">    private Paint mPaint;</div><div class="line">    private Context context;</div><div class="line"></div><div class="line">    public DividerItemDecoration(Context context) &#123;</div><div class="line">        this(context, 16, LinearLayoutManager.VERTICAL);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public DividerItemDecoration(Context context, float size) &#123;</div><div class="line">        this(context, size, LinearLayoutManager.VERTICAL);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public DividerItemDecoration(Context context, int orientation) &#123;</div><div class="line">        this(context, 16, orientation);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public DividerItemDecoration(Context context, float size, int orientation) &#123;</div><div class="line">        if (orientation != LinearLayoutManager.VERTICAL &amp;&amp; orientation != LinearLayoutManager.HORIZONTAL) &#123;</div><div class="line">            throw new IllegalArgumentException(&quot;the orientation is not VERTICAL or HORIZONTAL!&quot;);</div><div class="line">        &#125;</div><div class="line">        this.context = context;</div><div class="line">        this.size = size;</div><div class="line">        this.orientation = orientation;</div><div class="line">        initAttrs();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onDraw(Canvas c, RecyclerView parent, RecyclerView.State state) &#123;</div><div class="line">        if (orientation == LinearLayoutManager.VERTICAL) &#123;</div><div class="line">            drawVertical(c, parent);</div><div class="line">        &#125; else &#123;</div><div class="line">            drawHorizontal(c, parent);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void getItemOffsets(Rect outRect, View view, RecyclerView parent, RecyclerView.State state) &#123;</div><div class="line">        if (orientation == LinearLayoutManager.VERTICAL) &#123;</div><div class="line">            outRect.set(0, 0, 0, itemSize);</div><div class="line">        &#125; else &#123;</div><div class="line">            outRect.set(0, 0, itemSize, 0);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void initAttrs() &#123;</div><div class="line">        itemSize = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, size, context.getResources().getDisplayMetrics());</div><div class="line">        mPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mPaint.setColor(Color.TRANSPARENT);</div><div class="line">        mPaint.setStyle(Paint.Style.FILL);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 绘制横向item分割线</div><div class="line">     *</div><div class="line">     * @param canvas 画布</div><div class="line">     * @param parent recyclerView</div><div class="line">     */</div><div class="line">    private void drawVertical(Canvas canvas, RecyclerView parent) &#123;</div><div class="line">        int left = parent.getPaddingLeft();</div><div class="line">        int right = parent.getWidth() - parent.getPaddingRight();</div><div class="line">        int childCount = parent.getChildCount();</div><div class="line">        for (int i = 0; i &lt; childCount; i++) &#123;</div><div class="line">            View child = parent.getChildAt(i);</div><div class="line">            RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) child</div><div class="line">                    .getLayoutParams();</div><div class="line">            int top = child.getBottom() + params.bottomMargin;</div><div class="line">            int bottom = top + itemSize;</div><div class="line">            canvas.drawRect(left, top, right, bottom, mPaint);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 绘制横向item分割线</div><div class="line">     *</div><div class="line">     * @param canvas 画布</div><div class="line">     * @param parent recyclerView</div><div class="line">     */</div><div class="line">    public void drawHorizontal(Canvas canvas, RecyclerView parent) &#123;</div><div class="line">        int top = parent.getPaddingTop();</div><div class="line">        int bottom = parent.getHeight() - parent.getPaddingBottom();</div><div class="line">        int childCount = parent.getChildCount();</div><div class="line">        for (int i = 0; i &lt; childCount; i++) &#123;</div><div class="line">            View child = parent.getChildAt(i);</div><div class="line">            RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) child</div><div class="line">                    .getLayoutParams();</div><div class="line">            int left = child.getRight() + params.rightMargin;</div><div class="line">            int right = left + itemSize;</div><div class="line">            canvas.drawRect(left, top, right, bottom, mPaint);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##item点击事件</p>
<p>RecyclerView本身没有给我们提供类似ListView的setOnItemClickListener的监听事件，所以我们只能自己去实现这样一个监听事件。<br>在我们定义的Adapter中定义一个OnItemClickListener接口，接口中定义一个OnItemClick()方法，之后我们需要对外提供一个方法去实现这个接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public interface OnItemClickListener &#123;</div><div class="line">    void onItemClick(View view, int position);</div><div class="line">&#125;</div><div class="line"></div><div class="line">private OnItemClickListener onItemClickListener;</div><div class="line">public void setOnItemClickListener(OnItemClickListener onItemClickListener) &#123;</div><div class="line">    this.onItemClickListener = onItemClickListener;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在onBindViewHolder中添加如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if (onItemClickListener != null) &#123;</div><div class="line">            ((ItemViewHolder) holder).itemView.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">                @Override</div><div class="line">                public void onClick(View v) &#123;</div><div class="line">                    onItemClickListener.onItemClick(((ItemViewHolder) holder).itemView, holder.getAdapterPosition());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后，如果需要给item实现点击事件，利用adapter.setOnItemClickListener()实现就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mAdapter.setOnItemClickListener(new RecyclerAdapter.OnItemClickListener() &#123;</div><div class="line">     @Override</div><div class="line">     public void onItemClick(View view, int position) &#123;</div><div class="line">        Toast.makeText(MainActivity.this, &quot;click &quot; + (position + 1), Toast.LENGTH_SHORT).show();</div><div class="line">     &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>##上拉加载更多<br>上拉加载更多这块，主要是给RecyclerView添加一个底部布局。RecyclerView.Adapter给我们提供了getItemViewType方法来告诉我们每个item是属于正常布局还是属于底部布局</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public int getItemViewType(int position) &#123;</div><div class="line">    if (position == texts.size()) &#123;</div><div class="line">       return FOOT_TYPE;//说明该item是底部</div><div class="line">    &#125;</div><div class="line">    return NORMAL_TYPE;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时为了实现加载数据，我们通过调用RecyclerView的addOnScrollListener()方法，实现onScrolled()方法和onScrollStateChanged()方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">mRecyclerView.addOnScrollListener(new RecyclerView.OnScrollListener() &#123;</div><div class="line">    @Override</div><div class="line">    public void onScrollStateChanged(RecyclerView recyclerView, int newState) &#123;</div><div class="line">        int itemLastIndex = mAdapter.getItemCount() - 1;//recyclerView最后一项位置</div><div class="line">        if (newState  == RecyclerView.SCROLL_STATE_IDLE  &amp;&amp; visibleLastIndex == itemLastIndex) &#123;</div><div class="line">            if (i &lt; 100) &#123;</div><div class="line">                mAdapter.setLoading(true);</div><div class="line">                mAdapter.notifyDataSetChanged();</div><div class="line">                new Handler().postDelayed(new Runnable() &#123;</div><div class="line">                   @Override</div><div class="line">                   public void run() &#123;</div><div class="line">                        setData();</div><div class="line">                        mAdapter.setLoading(false);</div><div class="line">                        mAdapter.notifyDataSetChanged();</div><div class="line">                   &#125;</div><div class="line">                &#125;, 2000);</div><div class="line">            &#125; else &#123;</div><div class="line">               mAdapter.setAll(true);</div><div class="line">               mAdapter.notifyDataSetChanged();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   @Override</div><div class="line">   public void onScrolled(RecyclerView recyclerView, int dx, int dy) &#123;</div><div class="line">        super.onScrolled(recyclerView, dx, dy);</div><div class="line">        visibleLastIndex = manager.findLastCompletelyVisibleItemPosition();</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>简单说下思路，调用此监听事件后，当RecyclerView在滑动过程中会不断回调一些数据来表示当前RecyclerView的状态。我们为了实现上拉加载更多，我们需要知道，当RecyclerView滑到底部时，同时继续向上滑动我们就需要加载更多数据，所以在onScrolled()方法中我们利用findLastCompleteVisibleItemPosition()方法来获得当前RecyclerView停止滑动时最后一个可见项的位置是多少，当RecyclerView在滑动状态改变时，我们判断如果RecylerView改变的状态是停止滑动同时当前可见项位置是Adapter除底部项外最后一个，那么这个时候我们就需要加载数据。</p>
<p>##注</p>
<ul>
<li>关于自定义分割线的部分主要参见该博客<a href="http://blog.csdn.net/jxxfzgy/article/details/43736385" target="_blank" rel="external">http://blog.csdn.net/jxxfzgy/article/details/43736385</a></li>
<li>由于作者能力有限，文章若有不足或者错误之处望指正交流</li>
<li>项目的Github地址：<a href="https://github.com/ReedGit/RecyclerViewDemo" target="_blank" rel="external">https://github.com/ReedGit/RecyclerViewDemo</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Reed" />
          <p class="site-author-name" itemprop="name">Reed</p>
           
              <p class="site-description motion-element" itemprop="description">Everything I Never Told You!</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Reed</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
